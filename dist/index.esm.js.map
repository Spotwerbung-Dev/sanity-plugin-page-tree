{"version":3,"file":"index.esm.js","sources":["../src/hooks/usePageTree.ts","../src/hooks/usePageTreeConfig.tsx","../src/helpers/uuid.ts","../src/components/PageTreeViewItemActions.tsx","../src/components/PageTreeViewItemStatus.tsx","../src/components/PageTreeViewItem.tsx","../src/components/PageTreeEditor.tsx","../src/components/PageTreeView.tsx","../src/hooks/useOptimisticState.ts","../src/components/PageTreeInput.tsx","../src/components/PageTreeField.tsx","../src/hooks/usePageTreeItem.ts","../src/components/SlugField.tsx","../src/validators/parent-validator.ts","../src/validators/slug-validator.ts","../src/schema/definePageType.ts","../src/index.ts"],"sourcesContent":["import { useMemo } from 'react';\nimport { useListeningQuery } from 'sanity-plugin-utils';\n\nimport { mapRawPageMetadatasToPageTree } from '../helpers/page-tree';\nimport { getAllRawPageMetadataQuery } from '../queries';\nimport { PageTreeConfig, RawPageMetadata } from '../types';\n\nexport const usePageTree = (config: PageTreeConfig) => {\n  const { data, loading } = useListeningQuery<RawPageMetadata[]>(getAllRawPageMetadataQuery(config), {\n    options: { apiVersion: config.apiVersion },\n  });\n\n  const pageTree = useMemo(() => (data ? mapRawPageMetadatasToPageTree(config, data) : undefined), [config, data]);\n\n  return {\n    isLoading: loading,\n    pageTree,\n  };\n};\n","import { createContext, PropsWithChildren, useContext } from 'react';\n\nimport { PageTreeConfig } from '../types';\n\nconst PageTreeConfigContext = createContext<{ config?: PageTreeConfig }>({});\n\nexport type PageTreeConfigProviderProps = {\n  config: PageTreeConfig;\n};\n\nexport const PageTreeConfigProvider = ({ children, config }: PropsWithChildren<PageTreeConfigProviderProps>) => (\n  <PageTreeConfigContext.Provider value={{ config }}>{children}</PageTreeConfigContext.Provider>\n);\n\nexport const usePageTreeConfig = () => {\n  const { config } = useContext(PageTreeConfigContext);\n\n  if (!config) {\n    throw new Error('Failed to get page tree config. Make sure to use the component in a PageTreeConfigProvider.');\n  }\n\n  return config;\n};\n","import { uuid } from '@sanity/uuid';\n\nexport const generateDraftId = () => `drafts.${uuid()}`;\n","import { AddIcon } from '@sanity/icons';\nimport { Box, Button, Flex, Menu, MenuButton, MenuItem, Text, Tooltip } from '@sanity/ui';\nimport { useEffect, useState } from 'react';\nimport { useClient, useSchema } from 'sanity';\nimport { useRouter } from 'sanity/router';\n\nimport { getLanguageFieldName } from '../helpers/config';\nimport { generateDraftId } from '../helpers/uuid';\nimport { usePageTreeConfig } from '../hooks/usePageTreeConfig';\nimport { PageTreeItem } from '../types';\n\nexport type PageTreeViewItemActionsProps = {\n  page: PageTreeItem;\n  onActionOpen: () => void;\n  onActionClose: () => void;\n};\n\nexport const PageTreeViewItemActions = ({ page, onActionOpen, onActionClose }: PageTreeViewItemActionsProps) => {\n  const schema = useSchema();\n  const config = usePageTreeConfig();\n  const client = useClient({ apiVersion: config.apiVersion });\n  const { navigateUrl, resolveIntentLink } = useRouter();\n  const [newPage, setNewPage] = useState<{ _id: string; _type: string } | undefined>();\n\n  const onAdd = async (type: string) => {\n    const language = getLanguageFieldName(config);\n    const doc = await client.create({\n      _id: generateDraftId(),\n      _type: type,\n      parent:\n        config.rootSchemaType === type\n          ? undefined\n          : {\n              _type: 'reference',\n              _ref: page._id,\n              _weak: true,\n              _strengthenOnPublish: { type: page._type },\n            },\n      ...(language ? { [language]: page[language] } : {}),\n    });\n    setNewPage(doc);\n  };\n\n  useEffect(() => {\n    if (newPage) {\n      const path = resolveIntentLink('edit', { id: newPage._id, type: newPage._type });\n      navigateUrl({ path });\n    }\n  }, [newPage, navigateUrl, resolveIntentLink]);\n\n  const menuButtons = config.pageSchemaTypes\n    .filter(\n      type =>\n        type !== config.rootSchemaType &&\n        (config.allowedParents?.[type] === undefined || config.allowedParents?.[type]?.includes(page._type)),\n    )\n    .map(type => (\n      <MenuItem key={type} onClick={() => onAdd(type)} text={schema.get(type)?.title ?? type} value={type} />\n    ));\n\n  const isAddPageButtonDisabled = menuButtons.length === 0;\n  const tooltipContent = isAddPageButtonDisabled ? (\n    <Box padding={1}>\n      <Text muted size={1}>\n        This page cannot have any child pages.\n      </Text>\n    </Box>\n  ) : undefined;\n\n  return (\n    <Tooltip content={tooltipContent} fallbackPlacements={['right', 'left']} placement=\"top\" portal>\n      <Flex gap={1} style={{ flexShrink: 0 }} onClick={e => e.stopPropagation()}>\n        <MenuButton\n          id=\"add-page-button\"\n          button={\n            <Button\n              mode=\"ghost\"\n              paddingX={2}\n              paddingY={2}\n              fontSize={1}\n              icon={AddIcon}\n              disabled={isAddPageButtonDisabled}\n            />\n          }\n          menu={<Menu>{menuButtons}</Menu>}\n          popover={{ placement: 'bottom' }}\n          onOpen={onActionOpen}\n          onClose={onActionClose}\n        />\n      </Flex>\n    </Tooltip>\n  );\n};\n","import { EditIcon, PublishIcon } from '@sanity/icons';\nimport { Box, Flex, Text, Tooltip, TooltipProps, useTheme } from '@sanity/ui';\nimport styled from 'styled-components';\n\nexport type PageTreeViewItemStatusProps = {\n  isPublished: boolean;\n  isDraft: boolean;\n};\n\nconst TOOLTIP_PROPS: Partial<TooltipProps> = {\n  fallbackPlacements: ['right', 'left'],\n  placement: 'top',\n  portal: true,\n};\n\nexport const PageTreeViewItemStatus = ({ isPublished, isDraft }: PageTreeViewItemStatusProps) => {\n  const theme = useTheme();\n\n  return (\n    <Flex gap={2} style={{ flexShrink: 0 }}>\n      <Tooltip\n        content={\n          <Box padding={2}>\n            <Text muted size={1}>\n              {isPublished ? 'Published' : 'Not published'}\n            </Text>\n          </Box>\n        }\n        {...TOOLTIP_PROPS}>\n        <OpacityBox opacity={isPublished ? 1 : 0.3}>\n          <PublishIcon fontSize={21} color={isPublished ? theme.sanity.color.muted.positive.enabled.fg : undefined} />\n        </OpacityBox>\n      </Tooltip>\n      <Tooltip\n        content={\n          <Box padding={2}>\n            <Text muted size={1}>\n              {isDraft ? 'Edited' : 'No unpublished edits'}\n            </Text>\n          </Box>\n        }\n        {...TOOLTIP_PROPS}>\n        <OpacityBox opacity={isDraft ? 1 : 0.3}>\n          <EditIcon fontSize={21} color={isDraft ? theme.sanity.color.muted.caution.enabled.fg : undefined} />\n        </OpacityBox>\n      </Tooltip>\n    </Flex>\n  );\n};\n\nconst OpacityBox = styled(Box)<{ opacity: number }>`\n  opacity: ${props => props.opacity};\n`;\n","import { ChevronDownIcon, ChevronUpIcon } from '@sanity/icons';\nimport { Button, Card, Flex, Stack, Text } from '@sanity/ui';\nimport { MouseEvent } from 'react';\nimport { useMemo, useState } from 'react';\nimport { usePaneRouter } from 'sanity/structure';\nimport styled from 'styled-components';\n\nimport { getLanguageFieldName, getRootPageSlug } from '../helpers/config';\nimport { flatMapPageTree } from '../helpers/page-tree';\nimport { usePageTreeConfig } from '../hooks/usePageTreeConfig';\nimport { NestedPageTreeItem } from '../types';\nimport { PageTreeViewItemActions } from './PageTreeViewItemActions';\nimport { PageTreeViewItemStatus } from './PageTreeViewItemStatus';\n\nexport type PageTreeViewItemProps = {\n  parentPath?: string;\n  page: NestedPageTreeItem;\n  onToggle: (page: NestedPageTreeItem) => void;\n  onClick?: (page: NestedPageTreeItem) => void;\n  openItemIds: string[];\n  disabledItemIds?: string[];\n  forceOpen?: boolean;\n  isRoot?: boolean;\n  allowedPageTypes?: string[];\n};\n\nexport const PageTreeViewItem = ({\n  page,\n  parentPath,\n  onToggle,\n  onClick,\n  openItemIds,\n  disabledItemIds,\n  allowedPageTypes,\n  forceOpen,\n  isRoot,\n}: PageTreeViewItemProps) => {\n  const config = usePageTreeConfig();\n  const { navigateIntent, routerPanesState, groupIndex } = usePaneRouter();\n\n  const [isHovered, setIsHovered] = useState(false);\n  const [hasActionOpen, setHasActionOpen] = useState(false);\n  const toggle = (e: MouseEvent<HTMLButtonElement>) => {\n    e.stopPropagation();\n    onToggle(page);\n  };\n\n  const onItemClick = () => {\n    if (isDisabled) return;\n\n    onClick ? onClick(page) : openPage();\n  };\n\n  const openPage = () => {\n    navigateIntent('edit', { id: page._id, type: page._type });\n  };\n\n  const path = parentPath ? `${parentPath}/${page.slug?.current}` : getLanguageFieldName(config) ?? '/';\n  const hasChildren = page.children.length > 0;\n\n  const currentPageNumber = routerPanesState[groupIndex + 1]?.[0]?.id;\n  const isSelected = currentPageNumber === page._id;\n  const isDisabled =\n    ((allowedPageTypes && !allowedPageTypes.includes(page._type)) ||\n      (disabledItemIds && disabledItemIds.some(id => id === page._id))) ??\n    false;\n\n  /**\n   * Check if page or is open based on passed openItemIds and page id and children ids\n   */\n  const isOpen = useMemo(() => {\n    if (forceOpen) {\n      return true;\n    }\n\n    const flatPages = page.children ? flatMapPageTree(page.children) : [];\n    const flatPageIds = [page._id, ...flatPages.map(p => p._id)];\n\n    return openItemIds.some(id => flatPageIds.includes(id));\n  }, [page._id, page.children, forceOpen, openItemIds]);\n\n  return (\n    <Card>\n      <Stack flex={1}>\n        <ItemContainer align=\"center\" gap={1}>\n          {!isRoot && <HorizontalLine />}\n          <Flex paddingLeft={3}>\n            {hasChildren && (\n              <Button\n                mode=\"ghost\"\n                padding={2}\n                fontSize={1}\n                icon={isOpen ? ChevronUpIcon : ChevronDownIcon}\n                onClick={toggle}\n                disabled={forceOpen}\n              />\n            )}\n          </Flex>\n          <Item\n            flex={1}\n            paddingLeft={1}\n            align=\"center\"\n            gap={3}\n            justify=\"space-between\"\n            hasMarginLeft={hasChildren}\n            isDisabled={isDisabled}\n            isSelected={isHovered || isSelected}\n            onMouseEnter={() => setIsHovered(true)}\n            onMouseLeave={() => setIsHovered(false)}\n            onClick={onItemClick}>\n            <Flex align=\"center\" gap={3}>\n              <UrlText isDisabled={isDisabled} textOverflow=\"ellipsis\">\n                {parentPath ? page.slug?.current : getRootPageSlug(page, config) ?? '/'}\n              </UrlText>\n              {!isDisabled && (isHovered || hasActionOpen) && (\n                <PageTreeViewItemActions\n                  page={page}\n                  onActionOpen={() => setHasActionOpen(true)}\n                  onActionClose={() => setHasActionOpen(false)}\n                />\n              )}\n            </Flex>\n            <PageTreeViewItemStatus isPublished={page.isPublished} isDraft={page.isDraft} />\n          </Item>\n        </ItemContainer>\n        {isOpen && (\n          <ChildContainer>\n            <VerticalLine />\n            {hasChildren && (\n              <Stack paddingY={1} space={2}>\n                {page.children.map(childPage => (\n                  <PageTreeViewItem\n                    key={childPage._id}\n                    page={childPage}\n                    parentPath={path}\n                    onToggle={onToggle}\n                    openItemIds={openItemIds}\n                    disabledItemIds={disabledItemIds}\n                    allowedPageTypes={allowedPageTypes}\n                    forceOpen={forceOpen}\n                    onClick={onClick}\n                  />\n                ))}\n              </Stack>\n            )}\n          </ChildContainer>\n        )}\n      </Stack>\n    </Card>\n  );\n};\n\nconst HorizontalLine = styled('div')`\n  background-color: ${({ theme }) => theme.sanity.color.card.enabled.border};\n  position: absolute;\n  height: 1px;\n  width: 2rem;\n  left: 0;\n  top: 50%;\n  transform: translateY(-50%);\n`;\n\nconst VerticalLine = styled('div')`\n  background-color: ${({ theme }) => theme.sanity.color.card.enabled.border};\n  position: absolute;\n  margin-top: -2px;\n  height: calc(100% - 16px);\n  width: 1px;\n  left: 0;\n  top: 0;\n`;\n\nconst ItemContainer = styled(Flex)`\n  position: relative;\n`;\n\nconst Item = styled(Flex)<{ hasMarginLeft: boolean; isSelected: boolean; isDisabled: boolean }>`\n  height: 1.75rem;\n  margin-left: ${({ hasMarginLeft }) => (hasMarginLeft ? '0rem' : '1.5rem')};\n  border-radius: 0.1875rem;\n  background-color: ${({ theme, isDisabled, isSelected }) =>\n    !isDisabled && isSelected ? theme.sanity.color.card.hovered.bg : undefined};\n\n  &:hover {\n    cursor: ${({ isDisabled }) => (!isDisabled ? 'pointer' : undefined)};\n  }\n`;\n\nconst UrlText = styled(Text)<{ isDisabled: boolean }>`\n  min-width: 0;\n  opacity: ${({ isDisabled }) => (isDisabled ? 0.5 : 1)};\n`;\n\nconst ChildContainer = styled(Card)`\n  margin-left: 1.5rem;\n  position: relative;\n`;\n","import { AddIcon, SearchIcon } from '@sanity/icons';\nimport { Box, Button, Flex, Text, TextInput } from '@sanity/ui';\nimport { without } from 'lodash';\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport { useClient } from 'sanity';\nimport { useRouter } from 'sanity/router';\nimport styled from 'styled-components';\n\nimport { findPageTreeItemById, flatMapPageTree } from '../helpers/page-tree';\nimport { generateDraftId } from '../helpers/uuid';\nimport { usePageTreeConfig } from '../hooks/usePageTreeConfig';\nimport { NestedPageTreeItem, PageTreeItem } from '../types';\nimport { PageTreeViewItem } from './PageTreeViewItem';\n\nexport type PageTreeEditorProps = {\n  pageTree: NestedPageTreeItem[];\n  onItemClick?: (page: NestedPageTreeItem) => void;\n  disabledItemIds?: string[];\n  initialOpenItemIds?: string[];\n  allowedPageTypes?: string[];\n};\n\ntype PageTreeState = {\n  query: string;\n  openItemIds: string[];\n};\n\nconst PAGE_TREE_STATE_KEY = 'sanity:page-tree-state';\n\nexport const PageTreeEditor = ({\n  pageTree,\n  onItemClick,\n  disabledItemIds,\n  initialOpenItemIds,\n  allowedPageTypes,\n}: PageTreeEditorProps) => {\n  const config = usePageTreeConfig();\n  const client = useClient({ apiVersion: config.apiVersion });\n  const { navigateUrl, resolveIntentLink } = useRouter();\n\n  const [pageTreeState, setPageTreeState] = useState<PageTreeState>(() => {\n    const sessionState = JSON.parse(sessionStorage.getItem(PAGE_TREE_STATE_KEY) || '{}');\n\n    return {\n      query: sessionState.query || '',\n      openItemIds: [...(sessionState.openItemIds || pageTree.map(page => page._id)), ...(initialOpenItemIds || [])],\n    };\n  });\n\n  useEffect(() => {\n    sessionStorage.setItem(PAGE_TREE_STATE_KEY, JSON.stringify(pageTreeState));\n  }, [pageTreeState]);\n\n  /**\n   * Filter page tree results recursively on title/slug based on search query\n   */\n  const filteredPageTree = useMemo(() => {\n    if (!pageTree) return;\n\n    const query = pageTreeState.query.toLowerCase();\n\n    const filter = (pages: NestedPageTreeItem[]): NestedPageTreeItem[] =>\n      pages.reduce((filteredPages: NestedPageTreeItem[], page) => {\n        let shouldInclude = true;\n\n        if (page.children) {\n          const children = filter(page.children);\n          if (children.length) {\n            filteredPages.push({ ...page, children });\n            shouldInclude = false;\n          }\n        }\n\n        if (shouldInclude) {\n          const slugSourceFieldValue = config.titleFieldName ? page[config.titleFieldName] : undefined;\n          const matchesSlug = page.slug?.current?.toLowerCase().includes(query);\n          const matchesTitle =\n            typeof slugSourceFieldValue === 'string' ? slugSourceFieldValue.toLowerCase().includes(query) : false;\n\n          if (matchesSlug || matchesTitle) {\n            filteredPages.push(page);\n          }\n        }\n\n        return filteredPages;\n      }, []);\n\n    return filter(pageTree);\n  }, [pageTree, pageTreeState.query, config.titleFieldName]);\n\n  /**\n   * Toggle page tree item. If item is opened, close it and all its children. If it is closed, just open it.\n   */\n  const togglePage = useCallback(\n    (page: PageTreeItem) => {\n      if (!pageTree) return;\n\n      const index = pageTreeState.openItemIds.indexOf(page._id);\n      // Closed item, open it\n      if (index === -1) {\n        setPageTreeState({ ...pageTreeState, openItemIds: [...pageTreeState.openItemIds, page._id] });\n        // Open item, close it and its children\n      } else {\n        const item = findPageTreeItemById(pageTree, page._id);\n        if (!item) return;\n\n        const childItems = flatMapPageTree([item]);\n        const itemIdsToClose = [item, ...childItems];\n        const newOpenItemIds = without(pageTreeState.openItemIds, ...itemIdsToClose.map(item => item._id));\n\n        setPageTreeState({ ...pageTreeState, openItemIds: newOpenItemIds });\n      }\n    },\n    [pageTreeState, setPageTreeState, pageTree],\n  );\n\n  const addRootPage = useCallback(async () => {\n    const doc = await client.create({\n      _id: generateDraftId(),\n      _type: config.rootSchemaType,\n    });\n    const path = resolveIntentLink('edit', { id: doc._id, type: doc._type });\n\n    navigateUrl({ path });\n  }, [client, config.rootSchemaType, resolveIntentLink, navigateUrl]);\n\n  return (\n    <Flex gap={3} direction=\"column\">\n      <Box>\n        <TextInput\n          icon={SearchIcon}\n          onChange={event => setPageTreeState({ ...pageTreeState, query: event.currentTarget.value })}\n          placeholder=\"Search\"\n          value={pageTreeState.query}\n        />\n      </Box>\n      {filteredPageTree?.length ? (\n        <Flex direction=\"column\">\n          {filteredPageTree.map(page => (\n            <PageTreeViewItem\n              key={page._id}\n              page={page}\n              onToggle={togglePage}\n              openItemIds={pageTreeState.openItemIds}\n              disabledItemIds={disabledItemIds}\n              allowedPageTypes={allowedPageTypes}\n              forceOpen={!!pageTreeState.query}\n              isRoot\n              onClick={onItemClick}\n            />\n          ))}\n        </Flex>\n      ) : (\n        <>\n          <Box paddingX={3} paddingY={3}>\n            <Text>No pages found</Text>\n          </Box>\n          <AddButton mode=\"ghost\" icon={AddIcon} text=\"Add root page\" onClick={addRootPage} />\n        </>\n      )}\n    </Flex>\n  );\n};\n\nconst AddButton = styled(Button)`\n  align-self: flex-start;\n`;\n","import { Card, Flex, Spinner, Stack } from '@sanity/ui';\nimport { forwardRef } from 'react';\nimport { UserComponent } from 'sanity/structure';\n\nimport { usePageTree } from '../hooks/usePageTree';\nimport { PageTreeConfigProvider } from '../hooks/usePageTreeConfig';\nimport { PageTreeConfig } from '../types';\nimport { PageTreeEditor } from './PageTreeEditor';\n\nexport type PageTreeViewProps = {\n  config: PageTreeConfig;\n} & UserComponent['propTypes'];\n\nexport const PageTreeView = forwardRef<HTMLDivElement, PageTreeViewProps>(({ config }, ref) => {\n  const { pageTree } = usePageTree(config);\n\n  return (\n    <PageTreeConfigProvider config={config}>\n      <Stack ref={ref} space={3}>\n        <Card padding={3}>\n          {!pageTree ? (\n            <Flex paddingY={4} justify=\"center\" align=\"center\">\n              <Spinner />\n            </Flex>\n          ) : (\n            <PageTreeEditor pageTree={pageTree} />\n          )}\n        </Card>\n      </Stack>\n    </PageTreeConfigProvider>\n  );\n});\n\nPageTreeView.displayName = 'PageTreeView';\n\nexport const createPageTreeView = (config: PageTreeConfig) => <PageTreeView config={config} />;\n","import { Dispatch, SetStateAction, useEffect, useState } from 'react';\n\nexport const useOptimisticState = <S>(state: S): [S, Dispatch<SetStateAction<S | null>>] => {\n  const [optimisticState, setOptimisticState] = useState<S | null>(null);\n\n  useEffect(() => {\n    if (optimisticState === state) {\n      setOptimisticState(null);\n    }\n  }, [state, optimisticState]);\n\n  return [optimisticState ?? state, setOptimisticState];\n};\n","import { Box, Card, Dialog, Flex, Spinner, Stack, Text } from '@sanity/ui';\nimport { useMemo, useState } from 'react';\nimport { ObjectInputProps, ReferenceValue, SanityDocument, set, useFormValue } from 'sanity';\nimport styled from 'styled-components';\n\nimport { findPageTreeItemById, flatMapPageTree } from '../helpers/page-tree';\nimport { useOptimisticState } from '../hooks/useOptimisticState';\nimport { usePageTree } from '../hooks/usePageTree';\nimport { PageTreeConfigProvider } from '../hooks/usePageTreeConfig';\nimport { PageTreeConfig, PageTreeItem } from '../types';\nimport { getSanityDocumentId } from '../utils/sanity';\nimport { PageTreeEditor } from './PageTreeEditor';\n\nexport const PageTreeInput = (\n  props: ObjectInputProps<ReferenceValue> & {\n    config: PageTreeConfig;\n    mode?: 'select-parent' | 'select-page';\n    schemaType: { to?: { name: string }[] };\n  },\n) => {\n  const mode = props.mode ?? 'select-page';\n  const form = useFormValue([]) as SanityDocument;\n  const { pageTree } = usePageTree(props.config);\n\n  const allowedPageTypes = props.schemaType.to?.map(t => t.name);\n\n  const [isPageTreeDialogOpen, setIsPageTreeDialogOpen] = useState(false);\n\n  const parentId = props.value?._ref;\n  const pageId = getSanityDocumentId(form._id);\n\n  const fieldPage = useMemo(() => (pageTree ? findPageTreeItemById(pageTree, pageId) : undefined), [pageTree, pageId]);\n  const parentPage = useMemo(\n    () => (pageTree && parentId ? findPageTreeItemById(pageTree, parentId) : undefined),\n    [pageTree, parentId],\n  );\n\n  const flatFieldPages = useMemo(() => (fieldPage ? flatMapPageTree([fieldPage]) : []), [fieldPage]);\n\n  const [parentPath, setOptimisticParentPath] = useOptimisticState<string | undefined>(parentPage?.path);\n\n  // Some page tree items are not suitable options for a new parent reference.\n  // Disable the current parent page, the current page and all of its children.\n  const disabledParentIds =\n    mode !== 'select-parent' ? [] : [...(parentId ? [parentId] : []), ...flatFieldPages.map(page => page._id)];\n  // Initially open the current page and all of its parents\n  const openItemIds = fieldPage?._id ? [fieldPage?._id] : undefined;\n\n  const openDialog = () => {\n    setIsPageTreeDialogOpen(true);\n  };\n\n  const closeDialog = () => {\n    setIsPageTreeDialogOpen(false);\n  };\n\n  const selectParentPage = (page: PageTreeItem) => {\n    // In the case of an array of references, we need to find the last path in the array and extract the _key\n    const lastPath = props.path[props.path.length - 1];\n    const _key = typeof lastPath === 'object' && '_key' in lastPath ? lastPath._key : undefined;\n\n    props.onChange(\n      set({\n        ...(_key ? { _key } : {}),\n        _ref: page._id,\n        _type: 'reference',\n        _weak: page.isDraft,\n        ...(page.isDraft ? { _strengthenOnPublish: { type: page._type } } : {}),\n      }),\n    );\n    setOptimisticParentPath(page.path);\n    closeDialog();\n  };\n\n  return (\n    <PageTreeConfigProvider config={props.config}>\n      <Stack space={3}>\n        {!pageTree ? (\n          <Flex paddingY={4} justify=\"center\" align=\"center\">\n            <Spinner />\n          </Flex>\n        ) : (\n          <Card padding={1} shadow={1} radius={2}>\n            <SelectedItemCard padding={3} radius={2} onClick={openDialog}>\n              <Text size={2}>{parentId ? parentPath ?? 'Select page' : 'Select page'}</Text>\n            </SelectedItemCard>\n          </Card>\n        )}\n      </Stack>\n      {pageTree && isPageTreeDialogOpen && (\n        <Dialog\n          header={'Select page'}\n          id=\"parent-page-tree\"\n          zOffset={1000}\n          width={1}\n          onClose={closeDialog}\n          onClickOutside={closeDialog}>\n          <Box padding={4}>\n            <PageTreeEditor\n              allowedPageTypes={allowedPageTypes}\n              pageTree={pageTree}\n              onItemClick={selectParentPage}\n              disabledItemIds={disabledParentIds}\n              initialOpenItemIds={openItemIds}\n            />\n          </Box>\n        </Dialog>\n      )}\n    </PageTreeConfigProvider>\n  );\n};\n\nconst SelectedItemCard = styled(Card)`\n  cursor: pointer;\n\n  &:hover {\n    background-color: ${({ theme }) => theme.sanity.color.card.hovered.bg};\n  }\n`;\n","import { FormField, ObjectFieldProps, ReferenceValue } from 'sanity';\n\nimport { PageTreeConfig } from '../types';\nimport { PageTreeInput } from './PageTreeInput';\n\nexport const PageTreeField = (\n  props: ObjectFieldProps<ReferenceValue> & {\n    config: PageTreeConfig;\n\n    mode?: 'select-parent' | 'select-page';\n    inputProps: { schemaType: { to?: { name: string }[] } };\n  },\n) => {\n  const inputProps = {\n    config: props.config,\n    mode: props.mode,\n    ...props.inputProps,\n  };\n\n  return (\n    <FormField title={props.title} inputId={props.inputId} validation={props.validation}>\n      <PageTreeInput {...inputProps} />\n    </FormField>\n  );\n};\n","import { ClientPerspective } from 'next-sanity';\nimport { useMemo } from 'react';\nimport { useListeningQuery } from 'sanity-plugin-utils';\n\nimport { getAllPageMetadata } from '../helpers/page-tree';\nimport { getAllRawPageMetadataQuery } from '../queries';\nimport { PageTreeConfig, RawPageMetadata } from '../types';\n\nexport const usePageTreeItem = (documentId: string, config: PageTreeConfig, perspective?: ClientPerspective) => {\n  const { data, loading } = useListeningQuery<RawPageMetadata[]>(getAllRawPageMetadataQuery(config), {\n    options: { apiVersion: config.apiVersion, perspective },\n  });\n\n  const pageTree = useMemo(() => (data ? getAllPageMetadata(config, data) : undefined), [config, data]);\n\n  return {\n    isLoading: loading,\n    page: pageTree?.find(page => page._id === documentId),\n  };\n};\n","import { Stack, Text } from '@sanity/ui';\nimport { Reference, SlugInputProps, SlugValue, useEditState, useFormValue } from 'sanity';\n\nimport { usePageTreeItem } from '../hooks/usePageTreeItem';\nimport { PageTreeConfig } from '../types';\nimport { getSanityDocumentId } from '../utils/sanity';\n\nexport type SlugFieldProps = {\n  config: PageTreeConfig;\n} & SlugInputProps;\n\nexport const SlugField = (props: SlugFieldProps) => {\n  const id = useFormValue(['_id']);\n  const type = useFormValue(['_type']);\n  // eslint-disable-next-line no-warning-comments\n  // TODO ideally this would be more type safe.\n\n  const parentRef = useFormValue(['parent']) as Reference | undefined;\n  const { config, value, renderDefault } = props;\n  return (\n    <Stack space={3}>\n      {renderDefault(props)}\n      {typeof id == 'string' && typeof type == 'string' && !!parentRef?._ref && (\n        <UrlExplanation id={id} type={type} parentId={parentRef?._ref} config={config} value={value} />\n      )}\n    </Stack>\n  );\n};\n\ntype UrlExplanationProps = {\n  id: string;\n  type: string;\n  parentId: string;\n  value: SlugValue | undefined;\n  config: PageTreeConfig;\n};\n\nconst UrlExplanation = ({ id, type, parentId, value, config }: UrlExplanationProps) => {\n  const state = useEditState(getSanityDocumentId(id), type ?? '');\n  const isPublished = !!state.published;\n\n  // we use published perspective so we don't get a draft version of the slug that has been changed of a parent page.\n  const { page, isLoading } = usePageTreeItem(parentId, config, 'published');\n\n  if (isLoading) return null;\n\n  const path = page?.path == '/' ? `${page?.path}${value?.current}` : `${page?.path}/${value?.current}`;\n\n  if (!config.baseUrl) {\n    return (\n      <Text muted size={1}>\n        Page url: {path}\n      </Text>\n    );\n  }\n\n  const url = `${config.baseUrl}${path}`;\n\n  if (!isPublished) {\n    <Text muted size={1}>\n      Page url once published: {url}\n    </Text>;\n  }\n\n  return (\n    <Text muted size={1}>\n      Link to page:\n      <a href={url} target=\"blank\">\n        {url}\n      </a>\n    </Text>\n  );\n};\n","import { Reference, ValidationContext } from 'sanity';\n\nimport { getLanguageFieldName } from '../helpers/config';\nimport { getRawPageMetadataQuery } from '../queries';\nimport { PageTreeConfig, RawPageMetadata } from '../types';\n\n/**\n * Validates that the slug is unique within the parent page and therefore that entire the path is unique.\n */\nexport const parentValidator =\n  (config: PageTreeConfig, ownType: string) =>\n  async (selectedParentRef: Reference | undefined, context: ValidationContext) => {\n    const client = context.getClient({ apiVersion: config.apiVersion });\n\n    if (!selectedParentRef) {\n      return true;\n    }\n\n    const parentId = selectedParentRef._ref;\n    const selectedParent = (await client.fetch<RawPageMetadata[]>(getRawPageMetadataQuery(parentId, config)))[0];\n\n    const allowedParentValidation = allowedParentValidator(selectedParent, config, ownType);\n    if (allowedParentValidation !== true) {\n      return allowedParentValidation;\n    }\n\n    return parentLanguageValidator(selectedParent, config, context);\n  };\n\nconst allowedParentValidator = (selectedParent: RawPageMetadata, config: PageTreeConfig, ownType: string) => {\n  const allowedParents = config.allowedParents?.[ownType];\n\n  if (allowedParents === undefined) {\n    return true;\n  }\n\n  if (!allowedParents.includes(selectedParent._type)) {\n    return `The parent of type \"${selectedParent._type}\" is not allowed for this type of document.`;\n  }\n\n  return true;\n};\n\nconst parentLanguageValidator = (\n  selectedParent: RawPageMetadata,\n  config: PageTreeConfig,\n  context: ValidationContext,\n) => {\n  if (config.documentInternationalization?.documentLanguageShouldMatchParent) {\n    const languageFieldName = getLanguageFieldName(config);\n    const language = context.document?.[languageFieldName];\n    const parentLanguage = selectedParent?.[languageFieldName];\n\n    if (language !== parentLanguage) {\n      return 'The language of the parent must match the language of the document.';\n    }\n  }\n\n  return true;\n};\n","import { SlugValue, ValidationContext } from 'sanity';\n\nimport { DRAFTS_PREFIX } from '../helpers/page-tree';\nimport { getAllRawPageMetadataQuery } from '../queries';\nimport { PageTreeConfig, RawPageMetadata, SanityRef } from '../types';\nimport { getSanityDocumentId } from '../utils/sanity';\n\n/**\n * Validates that the slug is unique within the parent page and therefore that entire the path is unique.\n */\nexport const slugValidator =\n  (config: PageTreeConfig) => async (slug: SlugValue | undefined, context: ValidationContext) => {\n    const client = context.getClient({ apiVersion: config.apiVersion });\n    const parentRef = context.document?.parent as SanityRef | undefined;\n\n    if (!parentRef) {\n      return true;\n    }\n\n    const allPages = await client.fetch<RawPageMetadata[]>(getAllRawPageMetadataQuery(config));\n    const siblingPages = allPages.filter(page => page.parent?._ref === parentRef._ref);\n\n    const siblingPagesWithSameSlug = siblingPages\n      .filter(\n        page => getSanityDocumentId(page._id) !== (context.document?._id && getSanityDocumentId(context.document._id)),\n      )\n      .filter(page => page.slug?.current?.toLowerCase() === slug?.current?.toLowerCase());\n\n    if (siblingPagesWithSameSlug.length) {\n      // If there is a sibling page with the same slug published, but a different slug in a draft, we want to show a more specific validation error to the user instead.\n      const siblingDraftPageWithSameSlug = siblingPages.find(\n        page =>\n          page._id.startsWith(DRAFTS_PREFIX) &&\n          page._id.includes(siblingPagesWithSameSlug[0]._id) &&\n          page.slug?.current?.toLowerCase() !== slug?.current?.toLowerCase(),\n      );\n\n      return siblingDraftPageWithSameSlug\n        ? `Slug must be unique. Another page with the same slug is already published, but has a draft version with a  different slug: \"${siblingDraftPageWithSameSlug.slug?.current}\". Publish that page first or change the slug to something else.`\n        : 'Slug must be unique.';\n    }\n\n    return true;\n  };\n","import { compact } from 'lodash';\nimport { defineField, defineType, DocumentDefinition, SlugOptions } from 'sanity';\n\nimport { PageTreeField } from '../components/PageTreeField';\nimport { SlugField } from '../components/SlugField';\nimport { PageTreeConfig } from '../types';\nimport { parentValidator } from '../validators/parent-validator';\nimport { slugValidator } from '../validators/slug-validator';\n\ntype Options = {\n  isRoot?: boolean;\n  fieldsGroupName?: string;\n  slugSource?: SlugOptions['source'];\n};\n\nfunction getPossibleParentsFromConfig(config: PageTreeConfig, ownType: DocumentDefinition): string[] {\n  if (config.allowedParents !== undefined && ownType.name in config.allowedParents) {\n    return config.allowedParents[ownType.name];\n  }\n  return config.pageSchemaTypes;\n}\n\nexport const definePageType = (\n  type: DocumentDefinition,\n  config: PageTreeConfig,\n  options: Options = { isRoot: false },\n) => {\n  const slugSourceFieldName = getSlugSourceField(config, options);\n\n  let slugSourceField;\n  let typeFields = type.fields;\n  if (slugSourceFieldName) {\n    slugSourceField = type.fields.find(field => field.name === slugSourceFieldName);\n    typeFields = type.fields.filter(field => field.name !== slugSourceFieldName);\n  }\n\n  return defineType({\n    ...type,\n    title: type.title,\n    fields: compact([slugSourceField, ...basePageFields(config, options, type), ...typeFields]),\n  });\n};\n\nconst basePageFields = (config: PageTreeConfig, options: Options, ownType: DocumentDefinition) => [\n  ...(!options.isRoot\n    ? [\n        defineField({\n          name: 'slug',\n          title: 'Slug',\n          type: 'slug',\n          options: {\n            source: getSlugSourceField(config, options),\n            isUnique: () => true,\n          },\n          components: {\n            input: props => SlugField({ ...props, config }),\n          },\n          validation: Rule => Rule.required().custom(slugValidator(config)),\n          group: options.fieldsGroupName,\n        }),\n      ]\n    : []),\n  ...(!options.isRoot\n    ? [\n        defineField({\n          name: 'parent',\n          title: 'Parent page',\n          type: 'reference',\n          to: getPossibleParentsFromConfig(config, ownType).map(type => ({ type })),\n          validation: Rule => Rule.required().custom(parentValidator(config, ownType.name)),\n          group: options.fieldsGroupName,\n          components: {\n            field: props => PageTreeField({ ...props, config, mode: 'select-parent' }),\n          },\n        }),\n      ]\n    : []),\n];\n\nconst getSlugSourceField = (config: PageTreeConfig, options: Options) => config.titleFieldName ?? options.slugSource;\n","import { DocumentList, StructureBuilder } from 'sanity/structure';\n\nimport { createPageTreeView } from './components/PageTreeView';\nimport { PageTreeDocumentListOptions } from './types';\n\nexport { PageTreeField } from './components/PageTreeField';\nexport { PageTreeInput } from './components/PageTreeInput';\nexport { definePageType } from './schema/definePageType';\nexport type { PageTreeConfig, PageTreeDocumentListOptions } from './types';\n\n/**\n * Creates a custom document list for the page tree.\n * @param S - Structure builder\n * @param config - Page tree config\n * @param extendDocumentList - Optional function to extend the document list builder to add custom title, filter etc.\n * @public\n */\nexport const createPageTreeDocumentList = (\n  S: StructureBuilder,\n  { config, extendDocumentList }: PageTreeDocumentListOptions,\n): DocumentList => {\n  const documentList = extendDocumentList ? extendDocumentList(S.documentList()) : S.documentList();\n\n  return Object.assign(\n    documentList.filter(`_type in [${config.pageSchemaTypes.map(type => `\"${type}\"`).join(',')}]`).serialize(),\n    {\n      // Prevents the component from re-rendering when switching documents\n      __preserveInstance: true,\n      key: 'pageTree',\n      type: 'component',\n      component: createPageTreeView(config),\n    },\n  );\n};\n"],"names":["usePageTree","config","data","loading","useListeningQuery","getAllRawPageMetadataQuery","options","apiVersion","pageTree","useMemo","mapRawPageMetadatasToPageTree","isLoading","PageTreeConfigContext","createContext","PageTreeConfigProvider","_ref","children","jsx","Provider","value","usePageTreeConfig","useContext","Error","generateDraftId","concat","uuid","PageTreeViewItemActions","_ref2","page","onActionOpen","onActionClose","schema","useSchema","client","useClient","navigateUrl","resolveIntentLink","useRouter","newPage","setNewPage","useState","onAdd","type","language","getLanguageFieldName","doc","create","_id","_type","parent","rootSchemaType","_weak","_strengthenOnPublish","useEffect","path","id","menuButtons","pageSchemaTypes","filter","_a","_b","_c","allowedParents","includes","map","MenuItem","onClick","text","get","title","isAddPageButtonDisabled","length","tooltipContent","Box","padding","Text","muted","size","Tooltip","content","fallbackPlacements","placement","portal","Flex","gap","style","flexShrink","e","stopPropagation","MenuButton","button","Button","mode","paddingX","paddingY","fontSize","icon","AddIcon","disabled","menu","Menu","popover","onOpen","onClose","TOOLTIP_PROPS","PageTreeViewItemStatus","_ref3","isPublished","isDraft","theme","useTheme","jsxs","OpacityBox","opacity","PublishIcon","color","sanity","positive","enabled","fg","EditIcon","caution","styled","__template","props","_d","_e","_f","PageTreeViewItem","_ref4","parentPath","onToggle","openItemIds","disabledItemIds","allowedPageTypes","forceOpen","isRoot","_g","navigateIntent","routerPanesState","groupIndex","usePaneRouter","isHovered","setIsHovered","hasActionOpen","setHasActionOpen","toggle","onItemClick","isDisabled","openPage","slug","current","hasChildren","currentPageNumber","isSelected","some","isOpen","flatPages","flatMapPageTree","flatPageIds","p","Card","Stack","flex","ItemContainer","align","HorizontalLine","paddingLeft","ChevronUpIcon","ChevronDownIcon","Item","justify","hasMarginLeft","onMouseEnter","onMouseLeave","UrlText","textOverflow","getRootPageSlug","ChildContainer","VerticalLine","space","childPage","_ref5","card","border","_ref6","_ref7","_ref8","hovered","bg","_ref9","_ref10","PAGE_TREE_STATE_KEY","PageTreeEditor","_ref11","initialOpenItemIds","pageTreeState","setPageTreeState","sessionState","JSON","parse","sessionStorage","getItem","query","setItem","stringify","filteredPageTree","toLowerCase","pages","reduce","filteredPages","shouldInclude","push","slugSourceFieldValue","titleFieldName","matchesSlug","matchesTitle","togglePage","useCallback","index","indexOf","item","findPageTreeItemById","childItems","itemIdsToClose","newOpenItemIds","without","addRootPage","direction","TextInput","SearchIcon","onChange","event","currentTarget","placeholder","Fragment","AddButton","PageTreeView","forwardRef","_ref12","ref","Spinner","displayName","createPageTreeView","useOptimisticState","state","optimisticState","setOptimisticState","PageTreeInput","form","useFormValue","schemaType","to","t","name","isPageTreeDialogOpen","setIsPageTreeDialogOpen","parentId","pageId","getSanityDocumentId","fieldPage","parentPage","flatFieldPages","setOptimisticParentPath","disabledParentIds","openDialog","closeDialog","selectParentPage","lastPath","_key","set","shadow","radius","SelectedItemCard","Dialog","header","zOffset","width","onClickOutside","_ref13","PageTreeField","inputProps","FormField","inputId","validation","usePageTreeItem","documentId","perspective","getAllPageMetadata","find","SlugField","parentRef","renderDefault","UrlExplanation","_ref14","useEditState","baseUrl","url","href","target","parentValidator","ownType","selectedParentRef","context","getClient","selectedParent","fetch","getRawPageMetadataQuery","allowedParentValidation","allowedParentValidator","parentLanguageValidator","documentInternationalization","documentLanguageShouldMatchParent","languageFieldName","document","parentLanguage","slugValidator","allPages","siblingPages","siblingPagesWithSameSlug","siblingDraftPageWithSameSlug","startsWith","DRAFTS_PREFIX","getPossibleParentsFromConfig","definePageType","slugSourceFieldName","getSlugSourceField","slugSourceField","typeFields","fields","field","defineType","compact","basePageFields","defineField","source","isUnique","components","input","Rule","required","custom","group","fieldsGroupName","slugSource","createPageTreeDocumentList","S","_ref15","extendDocumentList","documentList","Object","assign","join","serialize","__preserveInstance","key","component"],"mappings":"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"}